var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__slice=[].slice;(function(e,t){return typeof define=="function"&&define.amd?define(["jquery"],function(n){return e.WDP=t(n)}):e.WDP=t(e.$)})(this,function(e){var t;return t={},t.$=e,t.template='<div class="wdp dropdown-menu">  <div class="row-fluid">    <div class="span5 wdp-shortcuts"></div>    <div class="span7">      <table class="table-condensed wdp-calendar">        <thead>          <tr>              <th class="wdp-prev">                <a href="javascript:void(0)" class="js-wdp-prev"><i class="icon-arrow-left"/></a>              </th>              <th colspan="5" class="wdp-month-and-year js-wdp-set-month-year"></th>              <th class="wdp-next">                <a href="javascript:void(0)" class="js-wdp-next"><i class="icon-arrow-right"/></a>              </th>          </tr>        </thead>        <tbody></tbody>      </table>      <table class="table-condensed wdp-year-calendar">      <tbody></tbody>      </table>      <table class="table-condensed wdp-month-calendar">      <tbody></tbody>      </table>    </div>  </div></div>',t.DateUtils={format:function(e,t){return moment(e).format(t)},parse:function(e,t){return moment(e,t)}},t.configure=function(e){return t.template=e.template||t.template,t.DateUtils.format=e.dateFormat||t.DateUtils.format,t.DateUtils.parse=e.dateParse||t.DateUtils.parse},t.Keys={RETURN:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,H:72,J:74,K:75,L:76},t.Shortcuts=function(){function e(e){this.options=e,this._updateSelected=__bind(this._updateSelected,this),this._onShortcutClick=__bind(this._onShortcutClick,this),this.selectPrev=__bind(this.selectPrev,this),this.selectNext=__bind(this.selectNext,this),this.options||(this.options=this._defaults),this.$el=t.$("<ul>"),this.$el.on("click",this._onShortcutClick)}return e.prototype._defaults={Today:{days:0}},e.prototype.currSelectedIndex=-1,e.prototype.render=function(){var e,t,n,r;n=[],this.numShortcuts=0,r=this.options;for(e in r)t=r[e],n.push('<li><a          data-days="'+(t.days||0)+'"          data-months="'+(t.months||0)+'"          data-years="'+(t.years||0)+'"          data-shortcut-num="'+this.numShortcuts+'"          class="wdp-shortcut js-wdp-shortcut"          href="javascript:void(0)">'+e+"</a></li>"),this.numShortcuts++;return this.$el.html(n.join("")),this},e.prototype.resetClass=function(){return this.$el.find(".wdp-shortcut-active").removeClass("wdp-shortcut-active")},e.prototype.selectNext=function(){return this.currSelectedIndex=(this.currSelectedIndex+1)%this.numShortcuts,this._updateSelected()},e.prototype.selectPrev=function(){return this.currSelectedIndex=(this.currSelectedIndex-1)%this.numShortcuts,this.currSelectedIndex<0&&(this.currSelectedIndex=this.numShortcuts-1),this._updateSelected()},e.prototype.select=function(e){var t,n,r;return t=e.data(),r=moment(new Date),n={days:t.days,months:t.months,years:t.years},r.add(n),this.resetClass(),e.addClass("wdp-shortcut-active"),this.$el.trigger("dateselect",r.toDate())},e.prototype._onShortcutClick=function(e){return this.select(t.$(e.target))},e.prototype._updateSelected=function(){var e;return this.resetClass(),e=this.$el.find(".wdp-shortcut[data-shortcut-num="+this.currSelectedIndex+"]").addClass("wdp-shortcut-active"),this.select(e)},e}(),t.WaveDatepicker=function(){function n(e){var n,r,i=this;this.options=e,this._selectDate=__bind(this._selectDate,this),this._onInputKeydown=__bind(this._onInputKeydown,this),this._cancelEvent=__bind(this._cancelEvent,this),this._showMonthGrid=__bind(this._showMonthGrid,this),this._showYearGrid=__bind(this._showYearGrid,this),this._place=__bind(this._place,this),this._updateMonthAndYear=__bind(this._updateMonthAndYear,this),this._updateFromInput=__bind(this._updateFromInput,this),this.destroy=__bind(this.destroy,this),this.next=__bind(this.next,this),this.prev=__bind(this.prev,this),this.setDate=__bind(this.setDate,this),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.render=__bind(this.render,this),this.el=this.options.el,this.$el=t.$(this.el),this.dateFormat=this.options.format||this._defaultFormat,this._state={},this._updateFromInput(),this._initPicker(),this._initElements(),this._initEvents(),this.shortcuts=(new t.Shortcuts(e.shortcuts)).render(),this.$shortcuts.append(this.shortcuts.$el),(n=this.shortcuts)!=null&&n.resetClass(),(r=this.shortcuts)!=null&&r.resetClass(),this.$shortcuts.on("dateselect",function(e,t){return i.setDate(t)})}return n.prototype._defaultFormat="YYYY-MM-DD",n.prototype._state=null,n.prototype.render=function(){return this._updateMonthAndYear(),this._fill(),this._updateSelection(),this},n.prototype.show=function(){if(!this._isShown)return this._isShown=!0,this.$calendar.show(),this.$datepicker.addClass("show"),this.height=this.$el.outerHeight(),this._place(),this.$window.on("resize",this._place),this.$document.on("click",this.hide)},n.prototype.hide=function(){if(this._isShown)return this._isShown=!1,this.$calendarYear.hide(),this.$calendarMonth.hide(),this.$datepicker.removeClass("show"),this.$window.off("resize",this._place),this.$document.off("click",this.hide)},n.prototype.setDate=function(e){return this.date=e,this._state.month=this.date.getMonth(),this._state.year=this.date.getFullYear(),this.$el.val(this._formatDate(e)),this.$el.trigger("datechange",this.date)},n.prototype.getDate=function(){return this.date},n.prototype.prev=function(){return this._state.month===1?(this._state.month=12,this._state.year-=1):this._state.month-=1,this.render()},n.prototype.next=function(){return this._state.month===12?(this._state.month=1,this._state.year+=1):this._state.month+=1,this.render()},n.prototype.destroy=function(){return this.$datepicker.remove(),this.$el.removeData("datepicker")},n.prototype._initElements=function(){return this.options.className&&this.$el.addClass(this.options.className),this.$el.val(this._formatDate(this.date)),this.$shortcuts=this.$datepicker.find(".wdp-shortcuts"),this.$calendar=this.$datepicker.find(".wdp-calendar"),this.$calendarTbody=this.$calendar.find("tbody"),this.$calendarYear=this.$datepicker.find(".wdp-year-calendar"),this.$calendarYearTbody=this.$calendarYear.find("tbody"),this.$calendarMonth=this.$datepicker.find(".wdp-month-calendar"),this.$calendarMonthTbody=this.$calendarMonth.find("tbody"),this.$monthAndYear=this.$calendar.find(".wdp-month-and-year"),this.$window=e(window),this.$document=e(document)},n.prototype._initPicker=function(){var n;return this.$datepicker=e(t.template),this.$datepicker.appendTo(document.body),n=moment.weekdaysMin.join("</th><th>"),this.$datepicker.find("thead").append('<tr class="wdp-weekdays"><th>'+n+"</th></tr>")},n.prototype._initEvents=function(){return this.$el.on("focus",this.show),this.$el.on("mousedown",this.show),this.$el.on("change",this._updateFromInput),this.$el.on("datechange",this.render),this.$el.on("keydown",this._onInputKeydown),this.$el.on("click",this._cancelEvent),this.$datepicker.on("click",".js-wdp-calendar-cell",this._selectDate),this.$datepicker.on("click",".js-wdp-prev",this.prev),this.$datepicker.on("click",".js-wdp-next",this.next),this.$datepicker.on("click",this._cancelEvent),this.$datepicker.on("click",".js-wdp-set-month-year",this._showYearGrid),this.$datepicker.on("click",".js-wdp-year-calendar-cell",this._showMonthGrid),this.$datepicker.on("mousedown",this._cancelEvent)},n.prototype._updateFromInput=function(){var e;if(e=this.$el.val())this.date=this._parseDate(e);return this.date||(this.date=new Date),this.setDate(this.date)},n.prototype._updateMonthAndYear=function(){var e,t;return e=new Date(this._state.year,this._state.month,1),t=moment(e).format("MMMM YYYY"),this.$monthAndYear.text(t)},n.prototype._formatDate=function(e){return t.DateUtils.format(e,this.dateFormat)},n.prototype._parseDate=function(e){return t.DateUtils.parse(e,this.dateFormat).toDate()},n.prototype._place=function(){var t,n;return n=parseInt(this.$el.parents().filter(function(){return e(this).css("z-index")!=="auto"}).first().css("z-index"),10)+10,t=this.$el.offset(),this.$datepicker.css({top:t.top+this.height,left:t.left,zIndex:n})},n.prototype._showYearGrid=function(){var e,t,n,r,i;t=[],r=moment(new Date(this._state.year-9,0,1)),t.push('<tr class="wdp-calendar-row">');for(n=i=1;i<=20;n=++i)e=r.year()===this._state.year?"wdp-selected":"",t.push('<td class="js-wdp-year-calendar-cell '+e+'" data-date="'+r.format("YYYY-MM-DD")+'">'+r.format("YYYY")+"</td>"),n%5===0&&(t.push("</tr>"),n!==20&&t.push('<tr class"wdp-calendar-row">')),r.add("years",1);return this.$calendarYearTbody.html(t.join("")),this.$calendar.hide(),this.$calendarYear.show()},n.prototype._showMonthGrid=function(t){var n,r,i,s,o,u;i=[],r=moment(this._parseDate(e(t.target).data("date"))),o=moment(new Date(r.year(),0,1)),i.push('<tr class="wdp-calendar-row">');for(s=u=1;u<=12;s=++u)n=o.month()===this._state.month?"wdp-selected":"",i.push('<td class="js-wdp-calendar-cell '+n+'" data-date="'+o.format("YYYY-MM-DD")+'">'+o.format("MMM")+"</td>"),s%3===0&&(i.push("</tr>"),s!==12&&i.push('<tr class="wdp-calendar-row">')),o.add("months",1);return this.$calendarMonthTbody.html(i.join("")),this.$calendarYear.hide(),this.$calendarMonth.show()},n.prototype._fill=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;n=new Date(this._state.year,this._state.month,1),c=0,f=[],g=moment(n),r=g.daysInMonth(),m=g.clone().startOf("month"),i=g.clone().endOf("month"),s=m.day(),h=i.day(),d=0;if(s!==0){v=m.clone();for(l=y=0,w=s-1;0<=w?y<=w:y>=w;l=0<=w?++y:--y)c++===0&&f.push('<tr class="wdp-calendar-row">'),t=v.add("days",-1).date(),a=this._formatDate(new Date(this._state.year,this._state.month-1,t)),f[6-l+1]='<td class="wdp-calendar-othermonth js-wdp-calendar-cell" data-date="'+a+'">'+t+"</td>",d++}e=new Date(this._state.year,this._state.month,1);for(l=b=1;1<=r?b<=r:b>=r;l=1<=r?++b:--b)e.setDate(l),o=this._formatDate(e),c++%7===0&&f.push('</tr><tr class="wdp-calendar-row">'),f.push('<td class="js-wdp-calendar-cell" data-date="'+o+'">'+l+"</td>");p=i.clone();while(c<42)t=p.add("days",1).date(),u=this._formatDate(new Date(this._state.year,this._state.month+1,t)),c++%7===0&&f.push('</tr><tr class="wdp-calendar-row">'),f.push('<td class="wdp-calendar-othermonth js-wdp-calendar-cell" data-date="'+u+'">'+t+"</td>");return f.push("</tr>"),this.$calendarYear.hide(),this.$calendarMonth.hide(),this.$calendarTbody.html(f.join("")),this.$calendar.show()},n.prototype._cancelEvent=function(e){return e.stopPropagation(),e.preventDefault()},n.prototype._onInputKeydown=function(e){var n,r,i;switch(e.keyCode){case t.Keys.DOWN:case t.Keys.J:this._cancelEvent(e),r=this.shortcuts.selectNext,i=7,this.show();break;case t.Keys.RETURN:this.show();break;case t.Keys.UP:case t.Keys.K:this._cancelEvent(e),r=this.shortcuts.selectPrev,i=-7;break;case t.Keys.LEFT:case t.Keys.H:this._cancelEvent(e),i=-1;break;case t.Keys.RIGHT:case t.Keys.L:this._cancelEvent(e),i=1;break;case t.Keys.ESC:case t.Keys.TAB:this.hide()}if(e.shiftKey)return typeof r=="function"?r():void 0;if(i!=null)return n=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate()+i),this.shortcuts.resetClass(),this.setDate(n)},n.prototype._updateSelection=function(){var e;return e=this._formatDate(this.date),this.$calendarTbody.find(".wdp-selected").removeClass("wdp-selected"),this.$calendarTbody.find("td[data-date="+e+"]").addClass("wdp-selected")},n.prototype._selectDate=function(t){var n;return this.$calendarMonth.hide(),this.$calendar.show(),this.shortcuts.resetClass(),n=this._parseDate(e(t.target).data("date")),this.setDate(n)},n}(),e.fn.datepicker=function(){var n,r,i;return r=arguments[0],n=2<=arguments.length?__slice.call(arguments,1):[],r==null&&(r={}),typeof r=="string"&&r[0]!=="_"&&r!=="render"?(i=e(this).data("datepicker"),i!=null?i[r].apply(i,n):void 0):this.each(function(){var n;n=e(this),i=n.data("datepicker"),e.extend(r,{el:this});if(!i)return n.data("datepicker",i=(new t.WaveDatepicker(r)).render())})},t});